<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Submit Mplus models to a high-performance cluster scheduler — submitModels • MplusAutomation</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Submit Mplus models to a high-performance cluster scheduler — submitModels"><meta name="description" content="This function submits a group of Mplus models (.inp files) located within a
single directory or nested within subdirectories."><meta property="og:description" content="This function submits a group of Mplus models (.inp files) located within a
single directory or nested within subdirectories."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MplusAutomation</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/submitModels.html">Submitting Many Mplus Models to an HPC with submitModels()</a></li>
    <li><a class="dropdown-item" href="../articles/vignette.html">MplusAutomation Examples</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/michaelhallquist/MplusAutomation/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Submit Mplus models to a high-performance cluster scheduler</h1>
      <small class="dont-index">Source: <a href="https://github.com/michaelhallquist/MplusAutomation/blob/master/R/submitModels.R" class="external-link"><code>R/submitModels.R</code></a></small>
      <div class="d-none name"><code>submitModels.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function submits a group of Mplus models (.inp files) located within a
single directory or nested within subdirectories.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">submitModels</span><span class="op">(</span></span>
<span>  target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  recursive <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  filefilter <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  replaceOutfile <span class="op">=</span> <span class="st">"modifiedDate"</span>,</span>
<span>  Mplus_command <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  scheduler <span class="op">=</span> <span class="st">"slurm"</span>,</span>
<span>  sched_args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  env_variables <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  export_all <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cores_per_model <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  memgb_per_model <span class="op">=</span> <span class="fl">8L</span>,</span>
<span>  time_per_model <span class="op">=</span> <span class="st">"1:00:00"</span>,</span>
<span>  pre <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  post <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  batch_outdir <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  job_script_prefix <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  combine_jobs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  max_time_per_job <span class="op">=</span> <span class="st">"24:00:00"</span>,</span>
<span>  combine_memgb_tolerance <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  combine_cores_tolerance <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  debug <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  fail_on_error <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-target">target<a class="anchor" aria-label="anchor" href="#arg-target"></a></dt>
<dd><p>a character vector where each element is a directory containing Mplus input files
(.inp) to run OR a single .inp file to be run. Elements may be a full path, relative path,
or a filename within the working directory.
Defaults to the current working directory. Example: “C:/Users/Michael/Mplus Runs”</p></dd>


<dt id="arg-recursive">recursive<a class="anchor" aria-label="anchor" href="#arg-recursive"></a></dt>
<dd><p>optional. If <code>TRUE</code>, run all models nested in subdirectories
within <code>directory</code>. Defaults to <code>FALSE</code>. Not relevant if <code>target</code> is a single file.</p></dd>


<dt id="arg-filefilter">filefilter<a class="anchor" aria-label="anchor" href="#arg-filefilter"></a></dt>
<dd><p>a Perl regular expression (PCRE-compatible) specifying particular input
files to be run among those found in <code>target</code>. See <code>regex</code> or <a href="https://www.pcre.org/pcre.txt" class="external-link">https://www.pcre.org/pcre.txt</a>
for details about regular expression syntax.</p></dd>


<dt id="arg-replaceoutfile">replaceOutfile<a class="anchor" aria-label="anchor" href="#arg-replaceoutfile"></a></dt>
<dd><p>optional. Currently supports three settings: “always”, which
runs all models, regardless of whether an output file for the model exists; “never”,
which does not run any model that has an existing output file; and “modifiedDate”, which
only runs a model if the modified date for the input file is more recent than
the output file modified date (implying there have been updates to the model).</p></dd>


<dt id="arg-mplus-command">Mplus_command<a class="anchor" aria-label="anchor" href="#arg-mplus-command"></a></dt>
<dd><p>optional. N.B.: No need to pass this parameter for most users (has intelligent
defaults). Allows the user to specify the name/path of the Mplus executable to be used for
running models. This covers situations where Mplus is not in the system's path,
or where one wants to test different versions of the Mplus program.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>optional. If <code>FALSE</code>, show status messages in the console.</p></dd>


<dt id="arg-scheduler">scheduler<a class="anchor" aria-label="anchor" href="#arg-scheduler"></a></dt>
<dd><p>Which scheduler to use for job submission. Options are 'qsub', 'torque', 'sbatch', 'slurm', 'local', or 'sh'.
The terms <code>'qsub'</code> and <code>'torque'</code> are aliases (where 'torque' submits via the qsub command). Likewise for 'sbatch'
and 'slurm'. If <code>'local'</code> or  <code>'sh'</code> are specified, <code>submitModels</code> does not submit to any scheduler at all,
but instead executes the command locally via a shell script.</p></dd>


<dt id="arg-sched-args">sched_args<a class="anchor" aria-label="anchor" href="#arg-sched-args"></a></dt>
<dd><p>A character vector of arguments to be included in the scheduling command. On TORQUE, these
will typically begin with '-l' such as '-l wall_time=10:00:00'. These are added inside the submission script
for each model and are shared across all models. To add model-specific arguments, include <code>! #SBATCH</code> or
<code>! #PBS</code> lines inside the individual .inp files</p></dd>


<dt id="arg-env-variables">env_variables<a class="anchor" aria-label="anchor" href="#arg-env-variables"></a></dt>
<dd><p>A named character vector containing environment variables and their values to be passed
to the <code>script</code> at execution time. This is handled by the <code>-v</code> directive on TORQUE clusters and
by <code>--export</code> on Slurm clusters. The names of this vector are the environment variable names and
the values of the vector are the environment variable values to be passed in.
If you want to propagate the current value of an environment variable to the compute node at runtime,
use NA as the value of the element in <code>env_variables</code>. See examples.</p></dd>


<dt id="arg-export-all">export_all<a class="anchor" aria-label="anchor" href="#arg-export-all"></a></dt>
<dd><p>Whether to export all environment variables to the compute node at runtime. Default: FALSE</p></dd>


<dt id="arg-cores-per-model">cores_per_model<a class="anchor" aria-label="anchor" href="#arg-cores-per-model"></a></dt>
<dd><p>How many cpus/cores are requested for each model (can be overriden using <code>! BATCH</code> directives in .inp files).
Default: 1.</p></dd>


<dt id="arg-memgb-per-model">memgb_per_model<a class="anchor" aria-label="anchor" href="#arg-memgb-per-model"></a></dt>
<dd><p>amount of memory (RAM) requested for each model (in GB). Default: 8.</p></dd>


<dt id="arg-time-per-model">time_per_model<a class="anchor" aria-label="anchor" href="#arg-time-per-model"></a></dt>
<dd><p>amount of time requested for each model. Default: "1:00:00" (1 hour). If
a number is provided, we will treat this as the number of minutes.</p></dd>


<dt id="arg-pre">pre<a class="anchor" aria-label="anchor" href="#arg-pre"></a></dt>
<dd><p>user-specified shell commands  to include in the job script prior to running Mplus (e.g., module load commands)</p></dd>


<dt id="arg-post">post<a class="anchor" aria-label="anchor" href="#arg-post"></a></dt>
<dd><p>user-specified shell commands to include in the job script after Mplus runs (e.g., execute results wrangling script)</p></dd>


<dt id="arg-batch-outdir">batch_outdir<a class="anchor" aria-label="anchor" href="#arg-batch-outdir"></a></dt>
<dd><p>the directory where job scripts should be written</p></dd>


<dt id="arg-job-script-prefix">job_script_prefix<a class="anchor" aria-label="anchor" href="#arg-job-script-prefix"></a></dt>
<dd><p>the filename prefix for each job script</p></dd>


<dt id="arg-combine-jobs">combine_jobs<a class="anchor" aria-label="anchor" href="#arg-combine-jobs"></a></dt>
<dd><p>if TRUE, <code>submitModels</code> will seek to combine similar models into batches to reduce the total number of jobs</p></dd>


<dt id="arg-max-time-per-job">max_time_per_job<a class="anchor" aria-label="anchor" href="#arg-max-time-per-job"></a></dt>
<dd><p>The maximum time (in days-hours:minutes:seconds format) allowed for a combined job</p></dd>


<dt id="arg-combine-memgb-tolerance">combine_memgb_tolerance<a class="anchor" aria-label="anchor" href="#arg-combine-memgb-tolerance"></a></dt>
<dd><p>The memory tolerance for combining similar models in GB. Defaults to 1 (i.e., models that differ by &lt;= 1 GB can be combined)</p></dd>


<dt id="arg-combine-cores-tolerance">combine_cores_tolerance<a class="anchor" aria-label="anchor" href="#arg-combine-cores-tolerance"></a></dt>
<dd><p>The cores tolerance for combining models with similar core requests. Defaults to 2 (i.e., models whose core requests differ by &lt;= 2 can be combined)</p></dd>


<dt id="arg-debug">debug<a class="anchor" aria-label="anchor" href="#arg-debug"></a></dt>
<dd><p>a logical indicating whether to actually submit the jobs (TRUE) or just create the scripts for inspection (FALSE)</p></dd>


<dt id="arg-fail-on-error">fail_on_error<a class="anchor" aria-label="anchor" href="#arg-fail-on-error"></a></dt>
<dd><p>Whether to stop execution of the script (TRUE), or issue a warning (FALSE) if the job
submission fails. Defaults to TRUE.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data.frame recording details of the jobs submitted by <code>submitModels</code>. This can be passed to the <code>summary</code> function
or to <code>checkSubmission</code> to see the state of submitted jobs.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Note that if <code>fail_on_error</code> is <code>TRUE</code> and submission of one model fails, the submission loop will stop, rather than
submitting further models.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Michael Hallquist</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="fu">submitModels</span><span class="op">(</span><span class="st">"~/Michael/submitTest"</span>, recursive<span class="op">=</span><span class="cn">TRUE</span>, sched_args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"--mail=user"</span>, <span class="st">"--export=v"</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>    max_time_per_job <span class="op">=</span> <span class="st">"2:10:00"</span>, combine_jobs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Hallquist, Joshua Wiley.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

